"use strict";cookingApp.controller("AuthController",function($scope,$http,$location,communauteData,$route){$scope.userId=0,$scope.login=function(){$scope.userId=1,console.log($scope.userId)},$scope.logout=function(){$scope.userId=0}}),cookingApp.controller("CommunauteController",function($scope,$routeParams,communauteData,$location,rankingHelper,$filter,recetteData){communauteData.getCommunaute($routeParams.communauteId).$promise.then(function(communaute){$scope.communaute=communaute,recetteData.getAllRecette().$promise.then(function(recettes){$scope.communaute.recettes=$filter("byUserId")(recettes,communaute.id),$scope.communaute.countRecipes=$scope.communaute.recettes.length}),$scope.communaute.stars=rankingHelper.initCommunaute(communaute);var today=(new Date).getFullYear();$scope.communaute.age=today-communaute.birth})}),cookingApp.controller("CommunauteListController",function($scope,communauteData,$log,rankingHelper){$scope.communautes=communauteData.getAllCommunaute(),$scope.showLimit=8,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage",$scope.sortorder="name",$scope.initCommunaute=function(communaute){rankingHelper.initCommunaute(communaute)},$scope.showMore=function(){8===$scope.showLimit?($scope.showLimit="*",$scope.showMoreClass="glyphicon glyphicon-chevron-up",$scope.showMoreText="Afficher moins"):($scope.showLimit=8,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage")}}),cookingApp.controller("HomeController",function($scope,recetteData,rankingHelper){$scope.recettes=recetteData.getAllRecette(),$scope.initRecette=function(recette){rankingHelper.initRecette(recette)}}),cookingApp.controller("IngredientsController",function($scope,ingredientData,categoriesData){$scope.categoryFilter="*",$scope.nameFilter="",$scope.minKFilter=0,$scope.maxKFilter=1e3,$scope.ingredients=ingredientData.getAllIngredients(),$scope.categories=categoriesData.getAllCategories();var showLimit=4;$scope.showLimit=showLimit,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage",$scope.showMore=function(){$scope.showLimit===showLimit?($scope.showLimit="*",$scope.showMoreClass="glyphicon glyphicon-chevron-up",$scope.showMoreText="Afficher moins"):($scope.showLimit=showLimit,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage")}}),cookingApp.controller("NavigationController",function($scope,$routeParams,$location,$log){$scope.detailsCommunaute=function(){$location.replace(),$location.url("/communaute/"+$routeParams.communauteId)},$scope.createRecette=function(){$location.replace(),$location.url("/recette/add")},$scope.navigationInit=function(source){$scope.page_hom="page_hom"===source?"page_hom":"page_hom active",$scope.page_rec="page_rec"===source?"page_rec":"page_rec active",$scope.page_ing="page_ing"===source?"page_ing":"page_ing active",$scope.page_com="page_com"===source?"page_com":"page_com active"}}),Array.prototype.remove=function(value){var array=this;return _.without(array,array.getById(value))},Array.prototype.getById=function(idToInsert){for(var array=this,i=0;i<array.length;i++)if(array[i].id==idToInsert)return array[i];return{}},Array.prototype.insert=function(item){var array=this;array[array.length]=item},cookingApp.controller("RecetteAddController",function($scope,$log,recetteData,$location,categoriesData,ingredientData){$scope.categories=categoriesData.getAllCategories(),$scope.ingredients=ingredientData.getAllIngredients(),$scope.categorie="all",$scope.success=!1,$scope.failure=!1,$scope.ingredient="all",$scope.recipe={},$scope.recipe.ingredientsList=[],$scope.recipe.picture="img/recette_placeholder.jpg",$scope.onFileSelected=function(event){var selectedFile=event.target.files[0],reader=new FileReader,imgtag=document.getElementById("recipe_img");imgtag.title=selectedFile.name,reader.onload=function(event){imgtag.src=event.target.result,$scope.recipe.picture=imgtag.src},reader.readAsDataURL(selectedFile)},$scope.addIng=function(item){$scope.recipe.ingredientsList.insert($scope.ingredients.getById(item))},$scope.removeIng=function(item_id){$scope.recipe.ingredientsList=$scope.recipe.ingredientsList.remove(item_id)},$scope.getIng=function(item_id){$scope.recipe.ingredientsList.getById("item_id",item_id,$scope.ingredients)},$scope.getTotalCalories=function(){for(var total=0,i=0;i<$scope.recipe.ingredientsList.length;i++)total+=$scope.recipe.ingredientsList[i].calories;return total},$scope.saveRecette=function(recette,newRecetteForm){newRecetteForm.$valid?(recette.creatorId=1,recette.timestamp=(new Date).getTime(),recetteData.save(recette).$promise.then(function(response){$scope.success=!0,$scope.failure=!1}).catch(function(response){$scope.failure=!0,$scope.success=!1})):($scope.failure=!0,$scope.success=!1)},$scope.cancelEdit=function(){window.location="/recettes"}}),cookingApp.controller("RecetteController",function($scope,$routeParams,recetteData,rankingHelper,commentsData){$scope.showLimit=4,recetteData.getRecette($routeParams.recetteId).$promise.then(function(recette){$scope.recette=recette,$scope.recette.hearts=rankingHelper.initHearts(recette.note),$scope.show=recette.countComment>$scope.showLimit}),$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage",$scope.showMore=function(){4===$scope.showLimit?($scope.showLimit="*",$scope.showMoreClass="glyphicon glyphicon-chevron-up",$scope.showMoreText="Afficher moins"):($scope.showLimit=4,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage")},$scope.initRecette=function(recette){rankingHelper.initRecette(recette)},$scope.postComment=function(comment){comment.userId=1,console.log($scope.recette.id),comment.recipeId=$scope.recette.id,commentsData.save(comment)}}),cookingApp.controller("RecetteListController",function($scope,recetteData,rankingHelper,CONFIG){$scope.recettes=recetteData.getAllRecette(),$scope.showLimit=4,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage",$scope.ingredientFilter="",$scope.nameFilter="",$scope.minKFilter=0,$scope.maxKFilter=1e3,$scope.sortorder="name",$scope.initRecette=function(recette){rankingHelper.initRecette(recette)},$scope.showMore=function(){4===$scope.showLimit?($scope.showLimit="*",$scope.showMoreClass="glyphicon glyphicon-chevron-up",$scope.showMoreText="Afficher moins"):($scope.showLimit=4,$scope.showMoreClass="glyphicon glyphicon-chevron-down",$scope.showMoreText="Afficher d'avantage")}}),cookingApp.controller("TestController",function($scope){});